<!DOCTYPE html>
<html>
<head>
  <style>
    /* General styling */
    body {
      background-color: #121212;
      color: #EDEDED;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    /* Popup result style */
    .result-popup {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #1E1E1E;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
      display: none;
      z-index: 1000;
      font-size: 24px;
      text-align: center;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    .fade-out {
      animation: fadeOut 0.5s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateX(-50%) translateY(0); }
      to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }

    /* Header title */
    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    /* Top controls for duration and elimination in control groups */
    .top-controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }
    .control-group {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .control-group h2 {
      margin: 0;
      font-size: 20px;
    }
    .duration-options,
    .elimination-options {
      display: flex;
      gap: 10px;
    }
    .option-button {
      background-color: #333333;
      color: #EDEDED;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      border-radius: 25px;
      transition: background-color 0.3s, transform 0.2s ease-in-out;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    .option-button:hover {
      background-color: #4CAF50;
      transform: translateY(-3px);
    }
    .option-button.active {
      background-color: #4CAF50;
      color: white;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
    }

    /* Main content: wheel and names area */
    .main-content {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .wheel-container {
      width: 500px;
      height: 500px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .side-content {
      width: 250px;
    }

    /* Wheel and center spin styling */
    .wheel {
      position: relative;
    }
    #canvas {
      display: block;
      margin: 0 auto;
      width: 500px;
      height: 500px;
    }
    .center-circle {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background-color: #4CAF50;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }
    .spin-label {
      font-size: 16px;
      font-weight: bold;
      color: #fff;
    }
    /* Pointer triangle on the right side.
       Its bounding box is effectively 30px wide & 30px high.
       By setting right: 0 and translating -15px horizontally,
       its center aligns with the wheel border and its tip (pointing left) enters the wheel. */
    .pointer {
      width: 0;
      height: 0;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      border-right: 30px solid white;
      position: absolute;
      top: 50%;
      right: 0;
      transform: translate(10px, -50%);
      z-index: 3;
    }

    /* Text area for names */
    textarea {
      width: 100%;
      height: 450px;
      background-color: rgba(20, 20, 20, 0.4);
      caret-color: #EDEDED;
      resize: none;
      color: #EDEDED;
      border: 1px solid #444444;
      padding: 10px;
      border-radius: 8px;
    }

    /* Ad space */
    .ads {
      margin-top: 20px;
      text-align: center;
      padding: 10px;
      background-color: #1E1E1E;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body>
  <!-- Popup for showing result -->
  <div class="result-popup" id="resultPopup"><span id="resultText"></span></div>
  
  <div class="header">
    <h1>Welcome to Spin the Wheel</h1>
  </div>
  
  <!-- Top controls for duration and elimination -->
  <div class="top-controls">
    <div class="control-group">
      <h2>Duration:</h2>
      <div class="duration-options">
        <button class="option-button" onclick="selectDuration('slow')">Slow ðŸ˜±</button>
        <button class="option-button" onclick="selectDuration('medium')">Medium ðŸ¥±</button>
        <button class="option-button" onclick="selectDuration('fast')">Fast ðŸš€</button>
      </div>
    </div>
    <div class="control-group">
      <h2>Elimination Mode:</h2>
      <div class="elimination-options">
        <label style="cursor: pointer; display: flex; align-items: center;">
          <input type="checkbox" id="eliminateWinner" style="margin-right: 8px;"> Enable
        </label>
      </div>
    </div>
  </div>
  
  <!-- Main content: wheel on left, names on right -->
  <div class="main-content">
    <div class="wheel-container">
      <div class="wheel">
        <canvas id="canvas" width="450" height="450"></canvas>
        <div class="center-circle" onclick="spin()">
          <span class="spin-label">Spin</span>
        </div>
      </div>
      <!-- Pointer positioned on the right side -->
      <div class="pointer"></div>
    </div>
    <div class="side-content">
      <textarea rows="20" cols="30" oninput="createWheel()">cat
dog
cow
duck
sheep
goat
bird
neko
chicken</textarea>
    </div>
  </div>
  
  
  <script>
    // Helper functions
    function randomColor() {
      let r = Math.floor(Math.random() * 255);
      let g = Math.floor(Math.random() * 255);
      let b = Math.floor(Math.random() * 255);
      return { r, g, b };
    }
    function toRad(deg) {
      return deg * (Math.PI / 180);
    }
    function randomRange(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function easeInOutQuad(t) {
      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    }

    // Canvas and drawing variables
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const width = canvas.width;
    const height = canvas.height;
    const centerX = width / 2;
    const centerY = height / 2;
    const radius = width / 2;

    let items = document.getElementsByTagName("textarea")[0].value.split("\n").filter(item => item.trim() !== "");
    let currentDeg = 0;
    let step = 360 / items.length;
    let colors = [];
    let itemDegs = {};

    for (let i = 0; i < items.length; i++) {
      colors.push(randomColor());
    }

    function createWheel() {
      items = document.getElementsByTagName("textarea")[0].value.split("\n").filter(item => item.trim() !== "");
      step = items.length > 0 ? 360 / items.length : 360;
      if (colors.length !== items.length) {
        colors = [];
        for (let i = 0; i < items.length; i++) {
          colors.push(randomColor());
        }
      }
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, toRad(0), toRad(360));
      ctx.fillStyle = "rgb(33, 33, 33)";
      ctx.fill();

      let startDeg = currentDeg;
      itemDegs = {};
      for (let i = 0; i < items.length; i++, startDeg += step) {
        let endDeg = startDeg + step;
        let color = colors[i];
        let colorStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius - 2, toRad(startDeg), toRad(endDeg));
        let colorStyle2 = `rgb(${Math.max(color.r - 30, 0)}, ${Math.max(color.g - 30, 0)}, ${Math.max(color.b - 30, 0)})`;
        ctx.fillStyle = colorStyle2;
        ctx.lineTo(centerX, centerY);
        ctx.fill();

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius - 30, toRad(startDeg), toRad(endDeg));
        ctx.fillStyle = colorStyle;
        ctx.lineTo(centerX, centerY);
        ctx.fill();

        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(toRad((startDeg + endDeg) / 2));
        ctx.textAlign = "center";
        ctx.fillStyle = (color.r > 150 || color.g > 150 || color.b > 150) ? "#000" : "#fff";
        ctx.font = 'bold 24px Georgia';
        ctx.fillText(items[i], 130, 10);
        ctx.restore();

        itemDegs[items[i]] = { startDeg: startDeg, endDeg: endDeg };
      }
    }

    function updateWinner() {
      // We use a fixed pointer angle of 0Â° (from the right side) to determine the winning segment.
      const pointerAngle = 0;
      let winner = null;
      for (let i = 0; i < items.length; i++) {
        let startDeg = (itemDegs[items[i]].startDeg % 360 + 360) % 360;
        let endDeg = (itemDegs[items[i]].endDeg % 360 + 360) % 360;
        if (startDeg > endDeg) {
          if (pointerAngle >= startDeg || pointerAngle < endDeg) {
            winner = items[i];
            break;
          }
        } else {
          if (pointerAngle >= startDeg && pointerAngle < endDeg) {
            winner = items[i];
            break;
          }
        }
      }
      return winner;
    }

    function showResultPopup(result) {
      const popup = document.getElementById("resultPopup");
      const resultText = document.getElementById("resultText");
      resultText.textContent = result ? `Winner: ${result}` : "No winner!";
      popup.classList.remove("fade-out");
      popup.style.display = "block";
      popup.classList.add("fade-in");
      setTimeout(() => {
        popup.classList.remove("fade-in");
        popup.classList.add("fade-out");
        setTimeout(() => { popup.style.display = "none"; }, 500);
      }, 3000);
    }

    let speed = 0;
    let maxRotation = 0;
    let startTime = 0;
    let duration = 6000;
    let spinning = false;
    let selectedDuration = 'medium';

    function selectDuration(durationType) {
      document.querySelectorAll('.option-button').forEach(button => {
        button.classList.remove('active');
      });
      let button = document.querySelector(`button[onclick="selectDuration('${durationType}')"]`);
      if (button) button.classList.add('active');
      selectedDuration = durationType;
      switch (durationType) {
        case 'slow': duration = 10000; break;
        case 'medium': duration = 6000; break;
        case 'fast': duration = 3000; break;
      }
    }

    function animate(timestamp) {
      if (!spinning) return;
      if (!startTime) startTime = timestamp;
      let progress = (timestamp - startTime) / duration;
      if (progress >= 1) {
        progress = 1;
        spinning = false;
        speed = 0;
        let winner = updateWinner();
        showResultPopup(winner);
        if (document.getElementById("eliminateWinner").checked && winner) {
          eliminateWinner(winner);
        }
      }
      let easedProgress = easeInOutQuad(progress);
      currentDeg = startDeg + easedProgress * maxRotation;
      draw();
      if (spinning) {
        window.requestAnimationFrame(animate);
      }
    }

    function eliminateWinner(winner) {
      let index = items.indexOf(winner);
      if (index !== -1) {
        items.splice(index, 1);
        colors.splice(index, 1);
        step = items.length > 0 ? 360 / items.length : 360;
        let startDeg = currentDeg;
        itemDegs = {};
        for (let i = 0; i < items.length; i++) {
          let segmentStart = startDeg + i * step;
          itemDegs[items[i]] = { startDeg: segmentStart, endDeg: segmentStart + step };
        }
        let updateStart = 0;
        function updateWheel(timestamp) {
          if (!updateStart) updateStart = timestamp;
          let progress = (timestamp - updateStart) / 500;
          if (progress >= 1) { draw(); return; }
          draw();
          window.requestAnimationFrame(updateWheel);
        }
        window.requestAnimationFrame(updateWheel);
      }
    }

    let startDeg = 0;
    function spin() {
      if (spinning || items.length === 0) return;
      startDeg = currentDeg;
      let targetIndex = Math.floor(Math.random() * items.length);
      let targetStartDeg = itemDegs[items[targetIndex]].startDeg % 360;
      let additionalRotations = randomRange(3, 6);
      if (selectedDuration === 'slow') additionalRotations = randomRange(5, 8);
      if (selectedDuration === 'fast') additionalRotations = randomRange(1, 3);
      maxRotation = (additionalRotations * 360) + (360 - targetStartDeg) + randomRange(-step / 2, step / 2);
      spinning = true;
      startTime = 0;
      window.requestAnimationFrame(animate);
    }

    document.addEventListener('DOMContentLoaded', () => {
      selectDuration('medium');
      draw();
    });
  </script>
</body>
</html>
